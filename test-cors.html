<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Conex√£o Supabase</title>
    <!-- Supabase SDK direto do CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        .result-box {
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 15px;
            border-radius: 5px;
            background-color: #f9f9f9;
            white-space: pre-wrap;
            overflow-x: auto;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .warning {
            background-color: #fff3cd;
            border-color: #ffeeba;
            color: #856404;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #bee5eb;
            color: #0c5460;
        }
        button {
            background-color: #FF7F50;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        button:hover {
            background-color: #e66c3f;
        }
        h1 {
            color: #FF7F50;
            border-bottom: 2px solid #FF7F50;
            padding-bottom: 10px;
        }
        h2 {
            margin-top: 30px;
            color: #333;
        }
        .actions {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <h1>Teste de Conex√£o Supabase</h1>
    <p>Esta p√°gina testa diferentes aspectos da conex√£o com o Supabase para identificar poss√≠veis problemas.</p>
    
    <div class="actions">
        <button id="testCDN">1. Verificar CDN</button>
        <button id="testConnection">2. Testar Conex√£o</button>
        <button id="testQuery">3. Testar Consulta</button>
        <button id="testCORS">4. Verificar CORS</button>
        <button id="testAPI">5. Testar API direta</button>
    </div>
    
    <h2>Resultados:</h2>
    <div id="results">
        <div class="result-box info">Clique nos bot√µes acima para realizar os testes...</div>
    </div>
    
    <script>
        // Configura√ß√µes do Supabase
        const supabaseUrl = 'https://jwyzbfbzxbedjskumgli.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp3eXpiZmJ6eGJlZGpza3VtZ2xpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3NjA4MDksImV4cCI6MjA2MzMzNjgwOX0.8GEehgGUF-9zv1WwneYZBs1K3VLEZtxB9v0R6An0GIc';
        
        // Fun√ß√£o para mostrar resultados
        function showResult(message, type = 'info') {
            const resultBox = document.createElement('div');
            resultBox.className = `result-box ${type}`;
            resultBox.textContent = message;
            
            // Adicionar timestamp
            const timestamp = new Date().toLocaleTimeString();
            const timestampElement = document.createElement('div');
            timestampElement.style.fontSize = '12px';
            timestampElement.style.marginTop = '10px';
            timestampElement.style.textAlign = 'right';
            timestampElement.textContent = `[${timestamp}]`;
            resultBox.appendChild(timestampElement);
            
            // Inserir no topo dos resultados
            const resultsContainer = document.getElementById('results');
            resultsContainer.insertBefore(resultBox, resultsContainer.firstChild);
        }
        
        // 1. Verificar CDN
        document.getElementById('testCDN').addEventListener('click', function() {
            try {
                if (typeof supabase === 'undefined') {
                    showResult('‚ùå Erro: Biblioteca supabase n√£o est√° dispon√≠vel. A importa√ß√£o do CDN falhou.', 'error');
                } else if (typeof supabase.createClient !== 'function') {
                    showResult('‚ùå Erro: A fun√ß√£o createClient n√£o est√° dispon√≠vel. A biblioteca carregou, mas n√£o corretamente.', 'error');
                } else {
                    showResult('‚úÖ Sucesso: A biblioteca Supabase carregou corretamente do CDN.', 'success');
                }
            } catch (error) {
                showResult(`‚ùå Erro ao verificar CDN: ${error.message}`, 'error');
            }
        });
        
        // 2. Testar Conex√£o
        document.getElementById('testConnection').addEventListener('click', async function() {
            try {
                showResult('üîÑ Testando conex√£o com Supabase...', 'info');
                
                if (typeof supabase === 'undefined') {
                    showResult('‚ùå Erro: Biblioteca supabase n√£o dispon√≠vel.', 'error');
                    return;
                }
                
                const { createClient } = supabase;
                if (typeof createClient !== 'function') {
                    showResult('‚ùå Erro: A fun√ß√£o createClient n√£o est√° dispon√≠vel.', 'error');
                    return;
                }
                
                const client = createClient(supabaseUrl, supabaseKey);
                if (!client) {
                    showResult('‚ùå Erro: N√£o foi poss√≠vel criar o cliente Supabase.', 'error');
                    return;
                }
                
                if (typeof client.from !== 'function') {
                    showResult('‚ùå Erro: O cliente foi criado, mas a fun√ß√£o .from() n√£o est√° dispon√≠vel.', 'error');
                    return;
                }
                
                showResult('‚úÖ Sucesso: Cliente Supabase inicializado corretamente.', 'success');
            } catch (error) {
                showResult(`‚ùå Erro ao testar conex√£o: ${error.message}`, 'error');
            }
        });
        
        // 3. Testar Consulta
        document.getElementById('testQuery').addEventListener('click', async function() {
            try {
                showResult('üîÑ Testando consulta √† tabela users...', 'info');
                
                if (typeof supabase === 'undefined') {
                    showResult('‚ùå Erro: Biblioteca supabase n√£o dispon√≠vel.', 'error');
                    return;
                }
                
                const { createClient } = supabase;
                const client = createClient(supabaseUrl, supabaseKey);
                
                const { data, error, count } = await client
                    .from('users')
                    .select('*', { count: 'exact' })
                    .limit(1);
                
                if (error) {
                    showResult(`‚ùå Erro na consulta: ${error.message}`, 'error');
                    return;
                }
                
                if (data) {
                    showResult(`‚úÖ Sucesso: Consulta realizada com sucesso. ${data.length} usu√°rio(s) encontrado(s) de um total de ${count}.`, 'success');
                } else {
                    showResult('‚ö†Ô∏è Aviso: A consulta n√£o retornou erro, mas tamb√©m n√£o retornou dados.', 'warning');
                }
            } catch (error) {
                showResult(`‚ùå Erro ao testar consulta: ${error.message}`, 'error');
            }
        });
        
        // 4. Verificar CORS
        document.getElementById('testCORS').addEventListener('click', async function() {
            try {
                showResult('üîÑ Verificando configura√ß√µes de CORS...', 'info');
                
                // Testar com uma solicita√ß√£o CORS
                const response = await fetch(`${supabaseUrl}/rest/v1/users?select=id`, {
                    method: 'GET',
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': `Bearer ${supabaseKey}`
                    }
                });
                
                if (response.ok) {
                    showResult('‚úÖ Sucesso: Solicita√ß√£o CORS bem-sucedida.', 'success');
                } else {
                    showResult(`‚ùå Erro CORS: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                if (error.message.includes('CORS')) {
                    showResult(`‚ùå Erro de CORS detectado: ${error.message}. Isso pode indicar um problema de configura√ß√£o no projeto Supabase.`, 'error');
                } else {
                    showResult(`‚ùå Erro ao testar CORS: ${error.message}`, 'error');
                }
            }
        });
        
        // 5. Testar API direta
        document.getElementById('testAPI').addEventListener('click', async function() {
            try {
                showResult('üîÑ Testando API REST direta...', 'info');
                
                const apiUrl = `${supabaseUrl}/rest/v1/users?select=count`;
                showResult(`Enviando solicita√ß√£o para: ${apiUrl}`, 'info');
                
                const response = await fetch(apiUrl, {
                    method: 'HEAD',
                    headers: {
                        'apikey': supabaseKey,
                        'Authorization': `Bearer ${supabaseKey}`,
                        'Content-Type': 'application/json',
                        'Prefer': 'count=exact'
                    }
                });
                
                if (response.ok) {
                    const count = response.headers.get('content-range')?.split('/')[1] || 'desconhecido';
                    showResult(`‚úÖ Sucesso: API REST direta funcionando. Total de registros: ${count}`, 'success');
                } else {
                    showResult(`‚ùå Erro API: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Erro ao testar API direta: ${error.message}`, 'error');
            }
        });
        
        // Inicializar com informa√ß√µes do ambiente
        document.addEventListener('DOMContentLoaded', function() {
            const userAgent = navigator.userAgent;
            const protocol = window.location.protocol;
            const host = window.location.host;
            
            showResult(`Informa√ß√µes do ambiente:
- Navegador: ${userAgent}
- Protocolo: ${protocol}
- Host: ${host}
- Supabase URL: ${supabaseUrl}
- Data/Hora: ${new Date().toLocaleString()}`, 'info');
        });
    </script>
</body>
</html> 